async function handleLogin() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const errorMessage = document.getElementById('error-message');
    errorMessage.textContent = '';

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });

    if (error) {
        errorMessage.textContent = 'فشل تسجيل الدخول. تأكد من البريد الإلكتروني وكلمة المرور.';
        return;
    }
    if (data.user) showDashboard(data.user);
}

async function handleSignup() {
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    const role = document.getElementById('signup-role').value;
    const errorMessage = document.getElementById('error-message');
    errorMessage.textContent = '';

    const { data, error } = await supabase.auth.signUp({
        email, password, options: { data: { role } }
    });

    if (error) {
        errorMessage.textContent = 'فشل إنشاء الحساب. قد يكون البريد الإلكتروني مستخدماً بالفعل.';
        return;
    }
    if (data.user) {
        alert('تم إنشاء الحساب بنجاح! يرجى تسجيل الدخول.');
        showLogin();
    }
}

async function handleLogout() {
    await supabase.auth.signOut();
    showLogin();
}
